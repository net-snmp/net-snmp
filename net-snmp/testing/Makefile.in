#
# Makefile for testing
#

TARG		= etest ktest misctest stest

USELIBS		= ../snmplib/libsnmp.$(SHLIB_EXTENSION)$(SHLIB_VERSION)
LIBS		= -L../snmplib $(CC_RUNTIME_ARG) -lsnmp @LIBS@

PARSEOBJS	=

CPPFLAGS	= -I.. -I$(srcdir)/.. -I$(srcdir)/../snmplib @CPPFLAGS@
CC		= @CC@ $(CPPFLAGS)

all: $(TARG)

#
# FIX	Ick, get rid of the direct reference to libsnmp.a...
#
etest:    etimetest.o $(PARSEOBJS) $(USELIBS)
	${CC} -o $@ etimetest.o ../snmplib/libsnmp.a $(PARSEOBJS) ${LDFLAGS} ${LIBS} 

ktest:    keymanagetest.o $(PARSEOBJS) $(USELIBS)
	${CC} -o $@ keymanagetest.o ../snmplib/libsnmp.a $(PARSEOBJS) ${LDFLAGS} ${LIBS} 

misctest:    misctest.o $(PARSEOBJS) $(USELIBS)
	${CC} -o $@ misctest.o ../snmplib/libsnmp.a $(PARSEOBJS) ${LDFLAGS} ${LIBS} 

stest:    scapitest.o $(PARSEOBJS) $(USELIBS)
	${CC} -o $@ scapitest.o ../snmplib/libsnmp.a $(PARSEOBJS) ${LDFLAGS} ${LIBS} 


clean:
	rm -f *.o core *.core $(TARG) 


install: installdirs $(TARG)
	@for i in $(TARG) ; \
		do $(INSTALL) $$i $(bindir) ; \
		echo "install:  installed $$i in $(bindir)" ; \
	done


installdirs:
	@$(SHELL) $(srcdir)/../mkinstalldirs $(snmplibdir) $(bindir)


dependlocal: 
	makedepend $(CPPFLAGS) $(srcdir)/*.c

depend: dependlocal

nosysdepend: 
	makedepend $(CPPFLAGS) *.c
	perl -n -i.bak -e ' if (/^# DO NOT DELETE THIS LINE/) {$$doit=1;} if ($$doit == 1) {s#/usr/(include|lib)/[^\s]+##g ; print if (! /^[\w]+\.o:\s*$$/);} else {print;}' Makefile

makefileindepend: nosysdepend
	cd snmpnetstat; $(MAKE) makefileindepend; cd ..
	perl -e ' rename("Makefile.in","Makefile.in.bak"); open(F,"Makefile.in.bak"); open(G,"Makefile"); open(O,">Makefile.in"); $$_ = <F>; while(!/^# DO NOT DELETE THIS LINE/) { print O $$_; $$_ = <F>; } print O $$_; $$_ = <G>; while(!/^# DO NOT DELETE THIS LINE/) { $$_ = <G>; } while (<G>) {print O $$_;} '


# DO NOT DELETE THIS LINE -- make depend depends on it.

T.o: ../config.h ../mib_module_config.h ../s/linux.h ../s/sysv.h
T.o: ../s/generic.h ../m/generic.h 
etimetest.o: ../config.h ../mib_module_config.h ../s/linux.h ../s/sysv.h
etimetest.o: ../s/generic.h ../m/generic.h 
etimetest.o: ./../snmplib/asn1.h ./../snmplib/snmp_api.h ./../snmplib/tools.h
etimetest.o: ./../snmplib/lcd_time.h ./../snmplib/snmp_debug.h
etimetest.o: ./../snmplib/callback.h
keymanagetest.o: ../config.h ../mib_module_config.h ../s/linux.h ../s/sysv.h
keymanagetest.o: ../s/generic.h ../m/generic.h 
keymanagetest.o:  ./../snmplib/asn1.h
keymanagetest.o: ./../snmplib/snmp_api.h ./../snmplib/keytools.h
keymanagetest.o: ./../snmplib/tools.h ./../snmplib/scapi.h
keymanagetest.o: ./../snmplib/transform_oids.h ./../snmplib/callback.h
misctest.o: ../config.h ../mib_module_config.h ../s/linux.h ../s/sysv.h
misctest.o: ../s/generic.h ../m/generic.h 
misctest.o: ./../snmplib/asn1.h ./../snmplib/snmp_api.h ./../snmplib/tools.h
misctest.o: ./../snmplib/transform_oids.h ./../snmplib/callback.h
scapitest.o: ../config.h ../mib_module_config.h ../s/linux.h ../s/sysv.h
scapitest.o: ../s/generic.h ../m/generic.h 
scapitest.o: ./../snmplib/asn1.h ./../snmplib/snmp_api.h
scapitest.o: ./../snmplib/keytools.h ./../snmplib/tools.h
scapitest.o: ./../snmplib/scapi.h ./../snmplib/transform_oids.h
scapitest.o: ./../snmplib/callback.h 
